<!DOCTYPE html> 
<html>
<head>
  <title>Our Qur'an Journey</title>

  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600&family=Poppins&display=swap" rel="stylesheet">

  <style>
    body {
      margin: 0;
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(to bottom, #0f3d2e, #145a42);
      color: white;
      text-align: center;
    }

    .container { padding: 40px 20px; }

    .moon {
      font-size: 70px;
      animation: glow 2s infinite alternate;
    }

    @keyframes glow {
      from { text-shadow: 0 0 10px #ffd700; }
      to { text-shadow: 0 0 35px #ffffff, 0 0 50px #ffd700; }
    }

    .title {
      font-family: 'Playfair Display', serif;
      font-size: 34px;
      margin: 10px 0;
    }

    .names {
      color: #ffd700;
      font-size: 22px;
      margin-bottom: 20px;
    }

    button {
      padding: 10px 20px;
      margin: 8px;
      border-radius: 25px;
      border: none;
      background: #ffd700;
      color: #0f3d2e;
      font-weight: bold;
      cursor: pointer;
    }

    #app {
      display: none;
      background: white;
      color: #0f3d2e;
      margin: 20px auto;
      padding: 25px;
      border-radius: 20px;
      width: 90%;
      max-width: 500px;
    }

    input, select {
      width: 100%;
      padding: 8px;
      margin-bottom: 15px;
      border-radius: 10px;
      border: 1px solid #ccc;
    }

    .circle {
      width: 120px;
      height: 120px;
      border-radius: 50%;
      margin: 10px auto;
      background: conic-gradient(#ffd700 0%, #ddd 0%);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      color: #0f3d2e;
    }

    .mainCircle {
      width: 100px;
      height: 100px;
      border-radius: 50%;
      margin: 10px auto;
      background: conic-gradient(#ffd700 0%, #ddd 0%);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      color: #0f3d2e;
      background-color: white;
    }

    .highlight {
      font-size: 20px;
      font-weight: bold;
      color: #00ffcc;
      animation: pulse 1.5s infinite;
    }

    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }

  </style>
</head>

<body>

<div class="container" id="mainScreen">

  <div class="moon">ðŸŒ™</div>
  <div class="title">Our Qur'an Journey</div>
  <div class="names">Yusra âœ¨ Aneez</div>

  <button onclick="selectUser('yusra')">Enter as Yusra</button>
  <button onclick="selectUser('anee')">Enter as Anee</button>

  <h3>Today's Progress</h3>

  <div>
    <p id="compareYusra"></p>
    <div class="mainCircle" id="circleY">0%</div>
  </div>

  <div>
    <p id="compareAnee"></p>
    <div class="mainCircle" id="circleA">0%</div>
  </div>

  <p id="matchMessage"></p>

</div>

<div id="app">

  <h3 id="username"></h3>

  <p>Date</p>
  <input type="date" id="date">

  <p>Juz</p>
  <input type="number" id="juz" min="1" max="30">

  <p>Surah</p>
  <select id="surah"></select>

  <p>Progress</p>
  <select id="progress">
    <option value="1">1/4</option>
    <option value="2">1/2</option>
    <option value="3">3/4</option>
    <option value="4">Full</option>
  </select>

  <div class="circle" id="progressCircle">0%</div>

  <button onclick="save()">Save Progress</button>
  <p id="halfMessage"></p>

  <button onclick="goBack()">Back</button>

</div>

<script type="module">

  const firebaseConfig = {
  apiKey: "AIzaSyDabMS-wVS_ktdqnJbnElZLaTD5Ftty7cM",
  authDomain: "quran-tracker-37a62.firebaseapp.com",
  projectId: "quran-tracker-37a62",
  storageBucket: "quran-tracker-37a62.firebasestorage.app",
  messagingSenderId: "553291625814",
  appId: "1:553291625814:web:9e5fc7b2fc05233d1c12f7",
  measurementId: "G-26BG9CESGP"
};

  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  let currentUser = "";

  // JUZ MAP (Surah start â†’ Juz)
  const surahJuzMap = {
    1:1,2:1,3:3,4:4,5:6,6:7,7:8,8:9,9:10,10:11,
    11:12,12:12,13:13,14:13,15:14,16:14,17:15,
    18:15,19:16,20:16,21:17,22:17,23:18,24:18,
    25:18,26:19,27:19,28:20,29:20,30:21,
    31:21,32:21,33:21,34:22,35:22,36:22,
    37:23,38:23,39:23,40:24,41:24,42:25,
    43:25,44:25,45:25,46:26,47:26,48:26,
    49:26,50:26,51:26,52:27,53:27,54:27,
    55:27,56:27,57:27,58:28,59:28,60:28,
    61:28,62:28,63:28,64:28,65:28,66:28,
    67:29,68:29,69:29,70:29,71:29,72:29,
    73:29,74:29,75:29,76:29,77:29,78:30,
    79:30,80:30,81:30,82:30,83:30,84:30,
    85:30,86:30,87:30,88:30,89:30,90:30,
    91:30,92:30,93:30,94:30,95:30,96:30,
    97:30,98:30,99:30,100:30,101:30,
    102:30,103:30,104:30,105:30,106:30,
    107:30,108:30,109:30,110:30,111:30,
    112:30,113:30,114:30
  };

  const surahSelect = document.getElementById("surah");

  for(let i=1;i<=114;i++){
    let option=document.createElement("option");
    option.value=i;
    option.text="Surah "+i;
    surahSelect.add(option);
  }

  surahSelect.addEventListener("change",()=>{
    let selected=surahSelect.value;
    document.getElementById("juz").value=surahJuzMap[selected];
  });

  document.addEventListener("DOMContentLoaded",()=>{
    const today=new Date().toISOString().split("T")[0];
    document.getElementById("date").value=today;
    loadComparison(today);
  });

  window.selectUser=function(name){
    currentUser=name;
    document.getElementById("mainScreen").style.display="none";
    document.getElementById("app").style.display="block";
    document.getElementById("username").innerText="User: "+name;
  }

  window.goBack=function(){
    document.getElementById("mainScreen").style.display="block";
    document.getElementById("app").style.display="none";
    loadComparison(document.getElementById("date").value);
  }

  window.save=async function(){
    const date=document.getElementById("date").value;
    const juz=document.getElementById("juz").value;
    const surah=document.getElementById("surah").value;
    const progress=document.getElementById("progress").value;

    await setDoc(doc(db,"progress",currentUser,"dates",date),{
      juz,surah,progress
    });

    updateCircle(progress);
    checkHalf(juz);
    loadComparison(date);
  }

  function updateCircle(progress){
    const percent=progress*25;
    const circle=document.getElementById("progressCircle");
    circle.style.background=`conic-gradient(#ffd700 ${percent}%, #ddd ${percent}%)`;
    circle.innerText=percent+"%";
  }

  function updateMainCircle(id,progress){
    const percent=progress?progress*25:0;
    const circle=document.getElementById(id);
    circle.style.background=`conic-gradient(#ffd700 ${percent}%, #ddd ${percent}%)`;
    circle.innerText=percent+"%";
  }

  function checkHalf(juz){
    if(juz>=15){
      document.getElementById("halfMessage").innerHTML=
      "ðŸŒŸ You have completed Half of the Qur'an (15 Juz) ðŸŒŸ";
    }
  }

  async function loadComparison(date){

    const y=await getDoc(doc(db,"progress","yusra","dates",date));
    const a=await getDoc(doc(db,"progress","anee","dates",date));

    const yData=y.exists()?y.data():null;
    const aData=a.exists()?a.data():null;

    document.getElementById("compareYusra").innerText=
      yData?"Yusra â†’ Juz "+yData.juz:"Yusra â†’ No entry";

    document.getElementById("compareAnee").innerText=
      aData?"Anee â†’ Juz "+aData.juz:"Anee â†’ No entry";

    updateMainCircle("circleY",yData?yData.progress:0);
    updateMainCircle("circleA",aData?aData.progress:0);

    if(yData && aData && yData.juz===aData.juz){
      document.getElementById("matchMessage").innerHTML=
      "<span class='highlight'>âœ¨ BOTH ARE IN SAME JUZ âœ¨</span>";
    } else {
      document.getElementById("matchMessage").innerHTML="";
    }
  }

</script>

</body>
</html>
